<odoo>
  <!-- ACTION: thermal report -->
  <record id="action_report_frcs_invoice_thermal" model="ir.actions.report">
    <field name="name">FRCS Invoice (Thermal)</field>
    <field name="model">account.move</field>
    <field name="report_name">enovasions_account.report_frcs_invoice_template_thermal</field>
    <field name="report_type">qweb-pdf</field>
    <field name="paperformat_id" ref="enovasions_account.paperformat_frcs_thermal_80"/>
    <field name="print_report_name">'FRCS - %s' % (object.name or '')</field>
  </record>

  <!-- TEMPLATE: 80mm ticket -->
  <template id="report_frcs_invoice_template_thermal">
    <t t-call="web.basic_layout">
      <t t-set="last_id" t-value="(docs and docs[-1].id) or False"/>
      <t t-foreach="docs" t-as="o">

        <!-- data -->
        <t t-set="data" t-value="o.post_response_json or {}"/>
        <t t-set="ext_code" t-value="data.get('invoiceCounterExtension') or ''"/>
        <t t-set="is_copy_flag" t-value="(o.is_copy_post_status or False)"/>
        <t t-set="is_training" t-value="(ext_code == 'TS') or (ext_code == 'TR')"/>
        <t t-set="is_proforma" t-value="(ext_code == 'AS') or (ext_code == 'AR')"/>
        <t t-set="is_non_fiscal" t-value="is_copy_flag or is_training or is_proforma"/>
        <t t-set="mode_label"
           t-value="ext_code == 'NS' and 'NORMAL SALE' or
                    ext_code == 'NR' and 'NORMAL REFUND' or
                    ext_code == 'AS' and 'PROFORMA SALE' or
                    ext_code == 'AR' and 'PROFORMA REFUND' or
                    ext_code == 'TS' and 'TRAINING SALE' or
                    ext_code == 'TR' and 'TRAINING REFUND' or ''"/>

        <!-- WRAP (monospace, no borders, no hyphenation) -->
        <div
          style="
            width:72mm;
            font-family: 'DejaVu Sans Mono', monospace;
            font-size:13px; line-height:1.35;
            letter-spacing:0; font-variant-ligatures:none;
            word-break:normal; overflow-wrap:break-word;
            hyphens:none; -webkit-hyphens:none; -ms-hyphens:none;
            border: 1 px solid #000;
          ">

          <!-- HEADER ASCII -->
          <div style="width:100% important; text-align:left; font-weight:normal;">
            ======== <t t-esc="is_non_fiscal and 'NOT A FISCAL INVOICE' or 'FISCAL INVOICE'"/> ========
          </div>
          <div t-if="is_copy_flag" style="text-align:left;">
            ======================== COPY ========================
          </div>

          <!-- SELLER (centered text blocks) -->
          <div style="text-align:center;">
            <div><t t-esc="data.get('tin','')"/></div>
            <div><t t-esc="data.get('businessName','')"/></div>
            <div><t t-esc="data.get('address','')"/></div>
          </div>

          <!-- KV (2 cols, borderless) -->
          <table style="width:100%; border:1px solid #fff !important; border-collapse:collapse; table-layout:fixed; font-size:12px;">
            <tr style="border:none !important; ">
              <td style="border:none; width:40%;">Cashier:</td>
              <td style="border:none; text-align:right;"><t t-esc="o.user_id.name or ''"/></td>
            </tr>
            <tr style="border:none !important; ">
              <td style="border:none !important; ">Buyer:</td>
              <td style="border:none; text-align:right;"><t t-esc="o.partner_id.name or ''"/></td>
            </tr>
            <tr style="border:none !important; ">
              <td style="border:none;">POS Number:</td>
              <td style="border:none; text-align:right;"><t t-esc="o.name or ''"/></td>
            </tr>
            <tr style="border:none !important; ">
              <td style="border:none;">POS Time:</td>
              <td style="border:none; text-align:right;"><t t-esc="data.get('sdcDateTime','')"/></td>
            </tr>
          </table>

          <!-- MODE ASCII RULE -->
          <div style="text-align:center; margin:6px 0;">
            ---------- <t t-esc="mode_label or ''"/> ----------
          </div>

          <!-- ITEMS HEADER (ASCII look, but aligned via table) -->
          <div style="text-align:center; font-weight:normal;">Items</div>
          <div>==================================</div>
          <table style="width:100%; border:1px solid #fff !important; table-layout:fixed; font-size:12px;">
            <thead>
              <tr style="border:none !important; ">
                <th style="border:none !important; text-align:left;  width:40%;">Name</th>
                <th style="border:none !important; text-align:right; width:20%; white-space:nowrap;">Price</th>
                <th style="border:none !important; text-align:right; width:20%; white-space:nowrap;">Qty.</th>
                <th style="border:none !important; text-align:right; width:20%; white-space:nowrap;">Total</th>
              </tr>
            </thead>
            <tbody>
              <t t-foreach="o.invoice_line_ids" t-as="l">
                <tr style="border:none !important; ">
                  <!-- wrap names only between words; never hyphenate -->
                  <td style="border:none; text-align:left; word-break:normal; overflow-wrap:break-word; hyphens:none;">
                    <t t-esc="(l.product_id.name or '')"/>
                    <t t-if="l.tax_ids"> (A)</t>
                  </td>
                  <!-- amounts never wrap -->
                  <td style="border:none; text-align:right; white-space:nowrap;"><t t-esc="'%.2f' % ((l.price_unit or 0.0))"/></td>
                  <td style="border:none; text-align:right; white-space:nowrap;"><t t-esc="'%.0f' % ((l.quantity or 0))"/></td>
                  <td style="border:none; text-align:right; white-space:nowrap;"><t t-esc="'%.2f' % ((l.price_subtotal or 0.0))"/></td>
                </tr>
              </t>
            </tbody>
          </table>
          <div>----------------------------------</div>
          <!-- TOTALS (2 cols, right-aligned amount) -->
          <table style="width:100%; border:1px solid #fff !important; border-collapse:collapse; font-size:12px;">
            <tr style="border:none !important; ">
              <td style="border:none; font-weight:normal;">Total Purchase:</td>
              <td style="border:none; text-align:right; font-weight:normal; white-space:nowrap;">
                <t t-esc="'%.2f' % ((o.amount_total or 0.0))"/>
              </td>
            </tr>
          </table>

          <t t-if="o.pos_order_ids.payment_ids">
            <table style="width:100%; border:1px solid #fff !important; border-collapse:collapse; font-size:12px;">
              <t t-foreach="o.pos_order_ids.payment_ids" t-as="p">
                <tr>
                  <td style="border:1px solid #fff !important;"><t t-esc="(p.payment_method_id.name or 'Other')"/>:</td>
                  <td style="border:1px solid #fff !important; text-align:right; white-space:nowrap;">
                    <t t-esc="'%.2f' % ((p.amount or 0.0))"/>
                  </td>
                </tr>
              </t>
            </table>
          </t>
          <t t-if="not o.pos_order_ids.payment_ids">
            <div>- â€”</div>
          </t>
          <div>==================================</div>
          <t t-if="data.get('taxItems')">
              <table style="width:100%; border:1px solid #fff !important; border-collapse:collapse; table-layout:fixed; font-size:12px;">
                <thead>
                  <tr>
                    <th style="border:1px solid #fff; text-align:left;  width:12ch;">Label</th>
                    <th style="border:1px solid #fff; text-align:left;  width:28ch;">Name</th>
                    <th style="border:1px solid #fff; text-align:right; width:10ch; white-space:nowrap;">Rate</th>
                    <th style="border:1px solid #fff; text-align:right; white-space:nowrap;">Tax</th>
                  </tr>
                </thead>

                <tbody>
                  <t t-set="tt" t-value="0.0"/>
                  <t t-foreach="data.get('taxItems', [])" t-as="tx">
                    <tr>
                      <td style="border:none; width:12ch;  text-align:left;  white-space:nowrap;">
                        <t t-esc="tx.get('label','')"/>
                      </td>
                      <td style="border:none; width:28ch;  text-align:left;  word-break:normal; overflow-wrap:break-word; hyphens:none;">
                        <t t-esc="tx.get('categoryName','')"/>
                      </td>
                      <td style="border:none; width:10ch;  text-align:right; white-space:nowrap;">
                        <t t-esc="tx.get('rate','0.00')"/>%
                      </td>
                      <td style="border:none; width:auto;  text-align:right; white-space:nowrap;">
                        <t t-esc="'%.2f' % ((tx.get('amount', 0.0) or 0.0))"/>
                      </td>
                    </tr>
                    <t t-set="tt" t-value="tt + (tx.get('amount', 0.0) or 0.0)"/>
                  </t>
                </tbody>

                <tfoot>
                  <tr>
                    <td style="border:none;" colspan="2"></td>
                    <td style="border:none; text-align:left; font-weight:normal; white-space:nowrap;">
                      <span style="margin-right:6px;">Total Tax:</span>
                    </td>
                    <td style="border:none; text-align:right; font-weight:normal; white-space:nowrap;">
                      <t t-esc="'%.2f' % ((tt or 0.0))"/>
                    </td>
                  </tr>
                </tfoot>
              </table>
          </t>
          <div>==================================</div>
          <table style="width:100%; border:1px solid #fff; border-collapse:collapse; font-size:12px;">
              <tr><td style="border:none;">SDC Time: <span style="border:none; float:right; text-align:right;"><t t-esc="data.get('sdcDateTime','')"/></span></td></tr>
              <tr><td style="border:none;">SDC Invoice No: <span style="border:none; float:right; word-break:break-all; text-align:right;"><t t-esc="data.get('invoiceNumber','')"/></span></td></tr>
              <tr><td style="border:none;">Invoice Counter:<span style="border:none; float:right; white-space:nowrap; text-align:right;"><t t-esc="data.get('invoiceCounter','')"/></span></td></tr>
          </table>
          <div>==================================</div>
          <!-- QR -->
          <div style="text-align:center; clear:both; margin-top:10px;" t-if="o.qr_code">
            <img style="width:55mm; height:55mm; display:block; margin:0 auto;" t-att-src="'data:image/png;base64,%s' % (o.qr_code.decode('utf-8'))"/>
          </div>

          <!-- FOOTER ASCII -->
          <div style="text-align:left; font-weight:normal; margin-top:15px; margin-bottom:10px clear:both; width:100% !important;  ">
            ===== <t t-esc="is_non_fiscal and 'END OF NON-FISCAL INVOICE' or 'END OF FISCAL INVOICE'"/> =====
          </div>

        </div>

        <!-- page break -->
        <div style="page-break-after:always;" t-if="o.id != last_id"></div>
      </t>
    </t>

    <!-- Only page size + global border kill -->
    <style>
      @page { size: 72mm auto; margin: 2mm; }
      table, th, td { border: none !important; }
      .o_report_layout .header, .o_report_layout .footer { display:none !important; }
    </style>
  </template>
</odoo>